<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>0.8-as átlagjáték – Egyfájlos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:Inter,system-ui;background:#0b1020;color:#fff}
    .container{max-width:900px;margin:0 auto;padding:20px}
    .card{background:#121935;padding:20px;border-radius:18px}
    label{display:block;margin-bottom:6px}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#0f1530;color:#fff}
    .btn{margin-top:10px;padding:10px 16px;border-radius:12px;border:none;background:#7c9aff;color:#fff;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .hidden{display:none}
    .pill{padding:6px 12px;border-radius:20px;background:#0f1530;margin-right:6px}
    .player-card{padding:12px;margin:6px 0;border-radius:12px;background:#0f1530}
    .rules{margin:20px 0;padding:14px;border-radius:12px;background:#0f1530}
  </style>
</head>
<body>
  <div class="container">
    <h1>0.8-as átlagjáték</h1>

    <!-- Player setup -->
    <div id="view-setup" class="card">
      <h3>Adj meg egy nevet és válassz színt!</h3>
      <label>Név</label>
      <input id="inp-name" placeholder="pl. Csillagharcos" maxlength="18">
      <label>Szín</label>
      <input id="inp-color" type="color" value="#ff6b6b">
      <button class="btn" id="btn-add">Hozzáadás</button>
      <div id="players"></div>
      <button class="btn" id="btn-continue" disabled>Tovább</button>
    </div>

    <!-- Rules view -->
    <div id="view-rules" class="card hidden">
      <h3>Szabályok</h3>
      <div class="rules">
        <p>Alapszabály: 0–100 közül választasz. A választások átlagának <b>0.8-szorosa</b> a cél; aki ehhez a legközelebb van, nyer. Minden másik játékos <b>−1 pont</b>.</p>
        <p>1 kieső után: Azonos számot választók diszkvalifikálva és <b>−1 pont</b>.</p>
        <p>2 kieső után: Ha valaki <b>pont a célt</b> választja, a többiek <b>−2 pont</b>.</p>
        <p>3 kieső után: Ketten maradva, ha az egyik <b>0</b>-t, a másik <b>100</b>-at választ, a <b>100</b> nyer.</p>
      </div>
      <button class="btn" id="btn-start">Induljon a játék!</button>
    </div>

    <!-- Game view -->
    <div id="view-game" class="card hidden">
      <h3>Kör: <span id="round-num">1</span></h3>
      <p>Átlag: <span id="avg-display">–</span> • Cél: <span id="target-display">–</span></p>
      <div id="player-area"></div>
      <button class="btn" id="btn-reveal" disabled>Eredmény kihirdetése</button>
      <button class="btn" id="btn-next" disabled>Következő kör</button>
    </div>
  </div>

<script>
const State={players:[],round:1,eliminated:0};
function $(s){return document.querySelector(s)}

function addPlayer(){
  const name=$('#inp-name').value.trim();
  const color=$('#inp-color').value;
  if(!name)return alert('Adj meg egy nevet!');
  if(State.players.some(p=>p.color===color))return alert('Ez a szín már foglalt!');
  State.players.push({id:Date.now()+"",name,color,points:0,alive:true,choice:null,locked:false});
  renderPlayers();
  $('#inp-name').value='';
  $('#btn-continue').disabled=State.players.length!==5;
}

function renderPlayers(){
  const wrap=$('#players');wrap.innerHTML='';
  State.players.forEach(p=>{
    const d=document.createElement('div');d.className='player-card';
    d.innerHTML=`<span style="color:${p.color}">⬤</span> ${p.name} (${p.points}p)`;
    wrap.appendChild(d);
  });
}

$('#btn-add').onclick=addPlayer;
$('#btn-continue').onclick=()=>{
  $('#view-setup').classList.add('hidden');
  $('#view-rules').classList.remove('hidden');
};
$('#btn-start').onclick=()=>{
  $('#view-rules').classList.add('hidden');
  $('#view-game').classList.remove('hidden');
  renderGame();
};

function renderGame(){
  $('#round-num').textContent=State.round;
  const wrap=$('#player-area');wrap.innerHTML='';
  State.players.filter(p=>p.alive).forEach(p=>{
    const d=document.createElement('div');d.className='player-card';
    d.innerHTML=`<b style="color:${p.color}">${p.name}</b> (${p.points}p)<br>
      <input type=number min=0 max=100 value="${p.choice??''}" ${p.locked?'disabled':''}
        oninput="onChoice('${p.id}',this.value)">
      ${p.locked?'<span class=pill>Lockolva</span>':`<button class=btn onclick=lockChoice('${p.id}')>Lock</button>`}`;
    wrap.appendChild(d);
  });
}

function onChoice(id,val){const p=State.players.find(x=>x.id===id);p.choice=Number(val);}
function lockChoice(id){const p=State.players.find(x=>x.id===id);if(p.choice==null)return; p.locked=true;renderGame();updateButtons();}
function updateButtons(){const alive=State.players.filter(p=>p.alive);$('#btn-reveal').disabled=!alive.every(p=>p.locked);} 

function computeResult(){
  const alive=State.players.filter(p=>p.alive);
  const avg=alive.reduce((a,b)=>a+b.choice,0)/alive.length;
  const target=+(avg*0.8).toFixed(2);
  $('#avg-display').textContent=avg.toFixed(2);
  $('#target-display').textContent=target.toFixed(2);
  $('#btn-next').disabled=false;$('#btn-reveal').disabled=true;
}
$('#btn-reveal').onclick=computeResult;
$('#btn-next').onclick=()=>{State.round++;State.players.forEach(p=>{p.choice=null;p.locked=false});$('#avg-display').textContent='–';$('#target-display').textContent='–';renderGame();updateButtons();$('#btn-next').disabled=true;}
</script>
</body>
</html>
